{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://hoosh.dev/schemas/session-file.json",
  "title": "Hoosh Session File",
  "description": "Schema for hoosh tagged mode session files (~/.hoosh/sessions/session_{PID}.json)",
  "type": "object",
  "required": ["terminal_pid", "created_at", "last_accessed", "messages"],
  "properties": {
    "terminal_pid": {
      "type": "integer",
      "minimum": 1,
      "description": "Terminal process ID (from $PPID environment variable)"
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "Session creation timestamp (ISO 8601 / RFC 3339)"
    },
    "last_accessed": {
      "type": "string",
      "format": "date-time",
      "description": "Last access timestamp (updated on every load/save)"
    },
    "messages": {
      "type": "array",
      "description": "Conversation message history",
      "items": {
        "$ref": "#/definitions/ConversationMessage"
      }
    },
    "context": {
      "type": "object",
      "description": "Extensible metadata (e.g., current working directory, tool state)",
      "additionalProperties": true
    }
  },
  "additionalProperties": false,
  "definitions": {
    "ConversationMessage": {
      "type": "object",
      "required": ["role"],
      "properties": {
        "role": {
          "type": "string",
          "enum": ["user", "assistant", "tool"],
          "description": "Message role (user input, assistant response, or tool output)"
        },
        "content": {
          "type": ["string", "null"],
          "description": "Message content (null for tool call messages)"
        },
        "tool_calls": {
          "type": ["array", "null"],
          "description": "Tool calls (present for assistant messages with tool invocations)",
          "items": {
            "$ref": "#/definitions/ToolCall"
          }
        },
        "tool_call_id": {
          "type": ["string", "null"],
          "description": "Tool call ID (present for tool response messages)"
        },
        "name": {
          "type": ["string", "null"],
          "description": "Tool name (present for tool response messages)"
        }
      },
      "additionalProperties": false
    },
    "ToolCall": {
      "type": "object",
      "required": ["id", "function"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique tool call identifier"
        },
        "type": {
          "type": "string",
          "enum": ["function"],
          "description": "Tool call type (always 'function' for now)"
        },
        "function": {
          "type": "object",
          "required": ["name", "arguments"],
          "properties": {
            "name": {
              "type": "string",
              "description": "Tool function name (e.g., 'bash', 'read', 'write')"
            },
            "arguments": {
              "type": "string",
              "description": "JSON-encoded tool arguments"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  },
  "examples": [
    {
      "terminal_pid": 12345,
      "created_at": "2026-01-23T14:30:22Z",
      "last_accessed": "2026-01-23T15:45:10Z",
      "messages": [
        {
          "role": "user",
          "content": "what files are in this directory?"
        },
        {
          "role": "assistant",
          "content": null,
          "tool_calls": [
            {
              "id": "call_abc123",
              "type": "function",
              "function": {
                "name": "bash",
                "arguments": "{\"command\":\"ls -la\"}"
              }
            }
          ]
        },
        {
          "role": "tool",
          "tool_call_id": "call_abc123",
          "name": "bash",
          "content": "total 24\ndrwxr-xr-x  5 user  staff  160 Jan 23 14:30 .\ndrwxr-xr-x  8 user  staff  256 Jan 22 10:15 ..\n-rw-r--r--  1 user  staff  1024 Jan 23 14:29 file1.txt\n-rw-r--r--  1 user  staff  2048 Jan 23 14:30 file2.txt"
        },
        {
          "role": "assistant",
          "content": "I can see two files in the current directory:\n- file1.txt (1 KB)\n- file2.txt (2 KB)"
        }
      ],
      "context": {
        "cwd": "/Users/user/projects/myapp",
        "shell": "zsh"
      }
    }
  ]
}
